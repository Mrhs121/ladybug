name: Test Alpine clang-format compatibility

on:
  workflow_dispatch:

jobs:
  test-alpine-clang:
    runs-on: ubuntu-latest
    container: alpine:3.20
    steps:
      - name: Install dependencies
        run: |
          apk add --no-cache git python3 clang18-extra-tools

      - uses: actions/checkout@v4
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name }}
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Show clang-format version
        run: /usr/lib/llvm18/bin/clang-format --version

      - name: Run clang-format check
        run: |
          python3 scripts/run-clang-format.py --clang-format-executable /usr/lib/llvm18/bin/clang-format -r src/ test/ tools/ extension/

  compare-with-ubuntu:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name }}
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Install clang-format
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-format-18

      - name: Show Ubuntu clang-format version
        run: /usr/bin/clang-format-18 --version

      - name: Run Ubuntu clang-format check
        run: |
          python3 scripts/run-clang-format.py --clang-format-executable /usr/bin/clang-format-18 -r src/ test/ tools/ extension/
